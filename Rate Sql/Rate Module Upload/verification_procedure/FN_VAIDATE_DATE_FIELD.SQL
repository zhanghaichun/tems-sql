DROP FUNCTION IF EXISTS FN_VAIDATE_DATE_FIELD;
CREATE FUNCTION `FN_VAIDATE_DATE_FIELD`(
  PARAM_DATE_STR VARCHAR(16)
) RETURNS BOOLEAN
BEGIN
  /**
   * 判断给出的日期字符串是否有效
   */
  
  DECLARE VALIDATE_FLAG BOOLEAN;
  DECLARE YEAR_SECTION VARCHAR(12);
  DECLARE DAY_SECTION VARCHAR(12);
  DECLARE MONTH_SECTION VARCHAR(12);

  DECLARE V_KEYWORD_COUNT VARCHAR(12);

  SET VALIDATE_FLAG = TRUE;
  /**
   * 首先确保字符串中包含两个 '/'
   */
  SET V_KEYWORD_COUNT = LENGTH(PARAM_DATE_STR) - LENGTH( REPLACE(PARAM_DATE_STR, '/', '') );

  IF (V_KEYWORD_COUNT != 2) THEN
    SET VALIDATE_FLAG = FALSE;
  ELSE

    SET DAY_SECTION = SUBSTRING( PARAM_DATE_STR, POSITION('/' IN PARAM_DATE_STR ) + 1, 2 );
    SET MONTH_SECTION = SUBSTRING_INDEX(PARAM_DATE_STR, '/', 1);
    SET YEAR_SECTION = SUBSTRING_INDEX(PARAM_DATE_STR, '/', -1);

    

    IF (DAY_SECTION < 1 || DAY_SECTION > 31) THEN
      SET VALIDATE_FLAG = FALSE;
    END IF;

    IF (MONTH_SECTION < 1 || MONTH_SECTION > 12) THEN
      SET VALIDATE_FLAG = FALSE;
    END IF;

    IF ( LENGTH(YEAR_SECTION)  != 4 || YEAR_SECTION < 1900 ) THEN
      SET VALIDATE_FLAG = FALSE;
    END IF;

    INSERT INTO event_journal(event_type)
    values( concat(MONTH_SECTION, '/', DAY_SECTION, '/', YEAR_SECTION, '-', VALIDATE_FLAG ) );


  END IF;

  RETURN VALIDATE_FLAG;

END;